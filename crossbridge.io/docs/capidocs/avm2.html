<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="theme-color" content="#A53F0E">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
		<title>CrossBridge</title>

		<meta name="viewport" content="width=devide-width, initial-scale=1" />

			<link href="../../design/styles.css" rel="stylesheet" type="text/css" />
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	</head>
	<body class=" docs docs_capidocs docs_capidocs_avm2">
		<div id="container">
			<header>
				<nav>
					<ul><li>
							<a href="../../">Home</a>
						</li><li>
							<a href="https://github.com/crossbridge-community/crossbridge">Github</a>
						</li><li>
							<a href="http://forum.crossbridge.io/">Forum</a>
						</li><li>
							<a href="../../README.html">Readme</a>
						</li><li>
							<a href="../Reference.html">Reference</a>
						</li><li>
							<a href="../samples.html">Samples</a>
						</li><li>
							<a href="./">C/C++ API</a>
						</li><li>
							<a href="../apidocs/">AS3 API</a>
						</li><li>
							<a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/">Flash API</a>
						</li>

					</ul>
				</nav>
				<div id="menutop">&nbsp;</div><!-- dirty -->
				<a id="logo" href="../../">
					<h1><img src="../../design/crossbridge-70h.png" alt="CrossBridge" /></h1>
				</a>
			</header>
			<div id="holder">
				<div id="content"><div class="container">

	

		<section>
		  <div class="page-header">
			<h2>C/C++ API Reference</h2>
		  </div>
		  <div>

			<h3>AVM2.h</h3>
			<p>The AVM2.h header file contains various low-level Crossbridge-specific utility functions and macros.</p>

			<table class="table">
			  <tr>
				<th>Function</th>
				<th>Description</th>
			  </tr>

				<tr>
                    <td>
                        <p>__avm2_apply_args</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__avm2_apply_args"></div> 
                    </td>
					<td>
						<p><code>#define __avm2_apply_args()</code></p>
						<p>Returns a pointer to data describing how to perform a call with the same arguments as were passed to the current function.</p>
						<p>For more information, see <a href="http://tigcc.ticalc.org/doc/gnuexts.html#SEC67" target="_new">http://tigcc.ticalc.org/doc/gnuexts.html#SEC67</a></p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__avm2_apply</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__avm2_apply"></div> 
                    </td>
					<td>
						<p><code>#define __avm2_apply(function, arguments, size)</code></p>
						<p>Invokes <span class="parameterName">function</span> with a copy of the parameters described by <span class="parameterName">arguments</span> and <span class="parameterName">size</span><em>.</em></p>
						<p>For more information, see <a href="http://tigcc.ticalc.org/doc/gnuexts.html#SEC67" target="_new">http://tigcc.ticalc.org/doc/gnuexts.html#SEC67</a></p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">function</span> - The function to be invoked.</li>
					      <li><span class="parameterName">arguments</span> - The arguments to be passed. This should be the value returned by <code>__avm2_apply_args()</code>.</li>
					      <li><span class="parameterName">size</span> - The number of bytes in the stack argument data.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__avm2_return</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__avm2_return"></div> 
                    </td>
					<td>
						<p><code>#define __avm2_return(result)</code></p>
						<p>Returns the value described by <span class="parameterName">result</span> from the containing function. </p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">result</span> - The value returned by <code>__avm2_apply</code>.</li>
					    </ul>

					</td>
				</tr>

				<tr>
                    <td>
                        <p>__builtin_va_arg_pack</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__builtin_va_arg_pack"></div> 
                    </td>
                	<td>
						<p><code>#define __builtin_va_arg_pack</code></p>
						<p>Error. Not supported in Crossbridge.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__builtin_va_arg_pack_len</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__builtin_va_arg_pack_len"></div> 
                    </td>
					<td>
						<p><code>#define __builtin_va_arg_pack_len</code></p>
						<p>Error. Not supported in Crossbridge.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__builtin_apply_args</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__builtin_apply_args"></div> 
                    </td>
					<td>
						<p><code>__avm2_apply_args</code> overrides <code>__builtin_apply_args</code>.</p>
						<p>For more information, see <a href="http://tigcc.ticalc.org/doc/gnuexts.html#SEC67" target="_new">http://tigcc.ticalc.org/doc/gnuexts.html#SEC67</a>.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__builtin_apply</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__builtin_apply"></div> 
                    </td>

					<td>
						<p><code>__avm2_apply</code> overrides <code>__builtin_apply</code>.</p>
						<p>For more information, see <a href="http://tigcc.ticalc.org/doc/gnuexts.html#SEC67" target="_new">http://tigcc.ticalc.org/doc/gnuexts.html#SEC67</a>.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>__builtin_return</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="__builtin_return"></div> 
                    </td>

					<td>
						<p><code>__avm2_return</code> overrides <code>__builtin_return</code>.</p>
						<p> For more information, see <a href="http://tigcc.ticalc.org/doc/gnuexts.html#SEC67" target="_new">http://tigcc.ticalc.org/doc/gnuexts.html#SEC67</a>.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_locked_id</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_locked_id"></div> 
                    </td>

					<td>
						<p><code>unsigned avm2_locked_id(unsigned *mtx);</code></p>
				      <p>Returns the id of the lock owner. Low-level concurrency primitives -- expect hangs or worse if not used properly.
							Non-recursive mutexes. </p>
				      <p><strong>Parameters:</strong></p>
					    <ul>
					      <li><span class="parameterName">mtx</span> - ID of lock owner or 0.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_lock</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_lock"></div> 
                    </td>

					<td>
						<p><code>void avm2_lock(unsigned *mtx);</code></p>
						<p>Low-level concurrency primitives -- expect hangs or worse if not used properly.
							Non-recursive mutexes.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">mtx</span> - lock with thread id. </li>
					    </ul>
					</td>
				 </tr>

				<tr>
                    <td>
                        <p>avm2_lock_id</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_lock_id"></div> 
                    </td>

					<td>
						<p><code>void avm2_lock_id(unsigned *mtx, unsigned id);</code></p>
						<p>Low-level concurrency primitives -- expect hangs or worse if not used properly.
							Non-recursive mutexes.</p>
					    <p><strong>Parameters</strong>:</p>
						<ul>
						  <li><span class="parameterName">mtx</span> - lock with any non-0 value.</li>
						  <li><span class="parameterName">id</span> - lock owner id.</li>
						</ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_unlock</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_unlock"></div> 
                    </td>

					<td>
						<p><code>void avm2_unlock(unsigned *mtx);</code></p>
						<p>Super low-level concurrency primitives -- expect hangs or worse if not used properly.
							Non-recursive mutexes.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">mtx</span> - unlock.</li>
					    </ul>

					</td>
				</tr>

				<tr>
					<td colspan="2"><strong>Address token-based conditions</strong></td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_msleep</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_msleep"></div> 
                    </td>

					<td>
						<p><code>int avm2_msleep(void *addr, unsigned *mtx, int timo);</code></p>
						<p>Waits for <span class="parameterName">addr</span> to be woken for <span class="parameterName">timo</span> milliseconds (or forever if <span class="parameterName">timo</span>==0).
							Releases mutex on entry, re-acquired before return 0 on timeout, non-zero on wake.</p>
					    <p><strong>Parameters</strong>:</p>
						<ul>
							<li><span class="parameterName">addr</span> - Sleep on address. </li>
							<li><span class="parameterName">mtx</span> - Must be locked on entry. </li>
							<li><span class="parameterName">timo</span> - Number of milliseconds this function waits for addr to be woken (forever if <span class="parameterName">timo</span>==0).</li>
						</ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_wake</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_wake"></div> 
                    </td>

					<td>
						<p><code>int avm2_wake(void *addr);</code></p>
						<p>Wake any threads msleeping on <span class="parameterName">addr</span>, returns non-zero if a thread was woken.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">addr</span> - Address pointing to sleeping threads.				    </li>
					    </ul>
				      <p><strong>Example Usage:</strong></p>
                    <p>See the <a href="../samples.html#T9">09_pthreads</a> sample</p></td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_wake_one</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_wake_one"></div> 
                    </td>

					<td>
						<p><code>int avm2_wake_one(void *addr);</code></p>
						<p>Wake zero (if none msleeping on <span class="parameterName">addr</span>) or one threads msleeping on <span class="parameterName">addr</span>, returns non-zero if any thread was woken.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">addr</span> - Address pointing to sleeping threads.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_thr_impersonate</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_thr_impersonate"></div> 
                    </td>

					<td>
						<p><code>void *avm2_thr_impersonate(long tid, void *(*proc)(void *), void *arg);</code></p>
						<p>Call <span class="parameterName">proc(arg)</span> while impersonating the thread specified by <span class="parameterName">tid</span>.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">tid</span> - Long containing the thread to impersonate.</li>
					      <li><span class="parameterName">proc</span> - The function pointer.</li>
					      <li><span class="parameterName">arg</span> - The data to pass to the function pointer.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_ui_thunk</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_ui_thunk"></div> 
                    </td>

					<td>
						<p><code>void *avm2_ui_thunk(void *(*proc)(void *), void *arg);</code></p>
						<p>Call <span class="parameterName">proc(arg)</span> on the UI Worker as calling thread.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">proc</span> - The function pointer.</li>
					      <li><span class="parameterName">arg</span> - The data to pass to the function pointer.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_is_ui_worker</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_is_ui_worker"></div> 
                    </td>

					<td>
						<p><code>int avm2_is_ui_worker();</code></p>
						<p>Returns non-zero if running on the UI Worker. </p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_wait_for_ui_frame</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_wait_for_ui_frame"></div> 
                    </td>

					<td>
						<p><code>int avm2_wait_for_ui_frame(int timo);</code></p>
						<p>Wait for a frame event or until timeout. Returns 0 on timeout.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">timo</span> - A timeout interval, in milliseconds.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_self_lock</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_self_lock"></div> 
                    </td>

					<td>
						<p><code>void avm2_self_lock();</code></p>
						<p>Lock this thread to this Worker -- recursive OK. </p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_self_unlock</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_self_unlock"></div> 
                    </td>

					<td>
						<p><code>void avm2_self_unlock();</code></p>
						<p>Unlock this thread.</p>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_self_msleep</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_self_msleep"></div> 
                    </td>

					<td>
						<p><code>int avm2_self_msleep(void *addr, int timo);</code></p>
						<p>Works like <code>avm2_msleep</code> with mtx being "self" -- "self" must be locked using <code>avm2_self_lock</code>.</p>
				      <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">addr</span> - Sleep on address.</li>
                          <li><span class="parameterName">timo</span> - Number of milliseconds this function waits for addr to be woken (forever if <span class="parameterName">timo</span>==0).</li>
                        </ul>
				    <p><strong>Example Usage:</strong></p>
                    <p>See the <a href="../samples.html#T9">09_pthreads</a> sample</p></td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_tramp_alloc</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_tramp_alloc"></div> 
                    </td>

					<td>
						<p><code>void *avm2_tramp_alloc(void *funPtr, int sret, void *arg0, void *arg1);</code></p>
						<p>Trampoline support. For more information, see sdk/usr/share/avm2_tramp.cpp.</p>
					    <p><strong>Parameters</strong>:</p>
					    <ul>
					      <li><span class="parameterName">funPtr</span> - Function pointer.</li>
					      <li><span class="parameterName">sret</span> - Size of the structure return type for POD or the negative size of the structure for non-POD.
					         Must be zero for a non-structure return type.</li>
					      <li><span class="parameterName">arg0</span> - First argument.</li>
					      <li><span class="parameterName">arg1</span> - Second argument.</li>
					    </ul>
					</td>
				</tr>

				<tr>
                    <td>
                        <p>avm2_tramp_free</p>
                        <!-- Ensure this section isn't partially hidden under the top nav when coming here via # URL -->
                        <div style="margin-top:-80px" id="avm2_tramp_free"></div> 
                    </td>

					<td>
						<p><code>void avm2_tramp_free(void *trampFunPtr);</code></p>
						<p>Trampoline support. For more information, see sdk/usr/share/avm2_tramp.cpp. </p>
					    <p><strong>Parameters:</strong></p>
					    <ul>
					      <li><span class="parameterName">trampFunPtr</span> - Function pointer to be freed.</li>
					    </ul>
					</td>
				</tr>
			</table>
		</div>
	</section>
  </div></div>
			</div>

			<footer>
				<span id="copyright">&copy;2015 The CrossBridge Community &amp; contributors </span>
			</footer>
		</div>
	</body>
</html>
